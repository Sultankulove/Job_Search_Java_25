databaseChangeLog:
  - changeSet:
      id: 004-1-fix-resumes-is-active
      author: eltur
      preConditions:
        onFail: CONTINUE
        onError: HALT
        nestedPreconditions:
          - tableExists:
              tableName: resumes
      changes:
        - sql:
            comment: "Нормализуем 0/1/NULL перед сменой типа"
            sql: |
              UPDATE resumes
              SET is_active = CASE
                                WHEN is_active IS NULL THEN 1
                                WHEN is_active = 0 THEN 0
                                ELSE 1
                              END;
        - modifyDataType:
            tableName: resumes
            columnName: is_active
            newDataType: boolean
        - addDefaultValue:
            tableName: resumes
            columnName: is_active
            defaultValueBoolean: true

  - changeSet:
      id: 004-2-fix-resumes-salary
      author: eltur
      preConditions:
        onFail: CONTINUE
        onError: HALT
        nestedPreconditions:
          - columnExists:
              tableName: resumes
              columnName: salary
      changes:
        - modifyDataType:
            tableName: resumes
            columnName: salary
            newDataType: numeric(10,2)
      rollback:
        - modifyDataType:
            tableName: resumes
            columnName: salary
            newDataType: real

  - changeSet:
      id: 004-3-resumes-id-autoincrement
      author: eltur
      preConditions:
        onFail: CONTINUE
        onError: HALT
        nestedPreconditions:
          - columnExists:
              tableName: resumes
              columnName: id
      changes:
        - addAutoIncrement:
            tableName: resumes
            columnName: id
            columnDataType: bigint
